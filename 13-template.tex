\documentclass[a4paper,12pt]{report}

\usepackage{alltt, fancyvrb, url}
\usepackage{graphicx}
\usepackage[utf8]{inputenc}
\usepackage{float}
\usepackage{hyperref}

% Questo commentalo se vuoi scrivere in inglese.
% \usepackage[italian]{babel}

% \usepackage[italian]{cleveref}
\usepackage{cleveref}

\title{Homer}

\author{Ceccacci Michele, Magnani Simone, Monticelli Alessandro}
\date{\today}


\begin{document}

\maketitle

\begin{abstract}
\end{abstract}

\tableofcontents

\chapter{Analysis}
\section{Requirements}

HOMER (HOMe EmulatoR) is an emulated domotic controller connected to lights, windows, and other domestic facilities.
The smart environment is mananged through a dashboard which allows the user to control devices, monitor sensors and electrical consumptions.
Each device should support updates in variable time units.
Some devices should act in a somewhat random way (but still predictable), while others should be fully deterministic.

\subsubsection{Functional Requirements}

\begin{itemize}
	\item The software should allow creating and controlling a lot of devices, such as:
	\begin{itemize}
		\item Lights
		\item Electrical outlets
		\item Doors, Locks and windows
		\item Temperature changer devices
		\item Air quality sensors
	\end{itemize}
	\item The software needs to be interactive, in order to see the effects of removing/adding certain types of devies on the simulated envrionment
	\item The software also needs a logger in order to allow users (and possibly machines) to keep track of state changes.
\end{itemize}

\subsubsection{Non-Functional Requirements}

\begin{itemize}
	\item Should performant enough to run on a desktop/laptop.
	\item User interface should be intuitive and user-friendly
	\item The project should be portable, and work on Windows, MacOS and Linux devices.
\end{itemize}

\section{Analysis and domain model}

The application will emulate a domotic environment, some smart devices and facilities monitoring.
Smart devices are common domestic devices as lights, electrical outlets, windows, doors and various sensors 
for monitoring indoor temperature and air quality along with electrical absorption.
The user will interact with the devices via the controller through a dashboard.

The main challenge will be modelling the communication between the controller 
and the different devices, which can have very different states.

\begin{figure}[H]
\centering{}
\includegraphics{img/analysis.pdf}
\caption{Schema UML dell'analisi del problema, con rappresentate le entità principali ed i rapporti fra loro}
\label{img:analysis}
\end{figure}

\chapter{Design}
\section{Architecture}

HOMER uses the MVC pattern. This is because we want to clearly seperate the application's business 
logic from the view, and make our software as modular as possibile. Our main building block is the Device interface, 
and each device will be responsible for its own behaviour. The communication between the view and each device 
is heavily inspired by REST applications, but we decided to let each device implement its own state in order to skip serialization/deserialization. 
This respects the single responsibilty principle. This is also more explicit, allowing each device to define its own fields.
The controller is divided in two subsections, a ViewManager and a DeviceManager, marking the fact that we want our view 
and model to be as orthogonal as possible.


\section{Detailed Design}
\subsection{Michele Ceccacci}
I developed the interfaces to add/remove devices, ui components to handle user inputs,
and the application's logger. Furthermore, i also created the air quality sensor,
and the devices responsible for temperature changers (heating and air conditioning).

\textbf{Logger} \newline
I was tasked with creating a logger, responsible for tracking 
the application's whole state. 
Problem: The logger has to be extensible, and needs to support loggers wrapping each other.
for example we might want to log timestamps first, and add some verbose warnings in some specific cases,
or vice versa.
We also want to be able to do this dynamically. We want to favour composition over inheritance, in order to make code simpler.
Solution: used the Decorator design pattern, which allows to wrap dynamically objects at runtime,
and overload their functionalities. It also allows for wrapping, and takes away the problems of inheritance. \newline
\includegraphics[width=16cm]{uml/logger.png}

\textbf{Air conditioning and Heating}\newline
Problem: In HOMER, air conditioning and heating devices basically do the same thing, but with a small difference. As long as they are
active, they bring up or down the environment's temperature by 1 degree celsius multiplied by their intensity for each hour that passed
since the last update.
We might also want to add new kind of temperature changers in the future, reacting differently to high/low temperatures.
Solution: Since the only function that actually changes between the two implementations is the one responsible for updating the
environment's temperature, we can use the template method pattern on the updateTemperature method. This allows us to keep maximum
flexibility in our implementation, and still limit our inheritance to one level, while still respecting the DRY principle.

\includegraphics[width=16cm]{uml/abstractTemperaturechanger.png}

\chapter{Development}
\section{Automated testing}
We used unit testing on especially on the model to prevent regressions, and we tested observable behaviour only.
Our unit test suite uses JUnit.
We decided not to test UI components, since our UI is not the main foucs,
and other areas of the model would benefit more from more granular testing. 


\section{Development notes}
The first step in our process was domain analysis, and then the insights gained were applied by modeling 
the project's main interfaces by using UML. 
We used Git as our DCVS. We used gitflow and feature branching, with dev as our development branch,
and main as our stable branch for releases. The workflow is based on pull requests and forks, allowing for asynchronous feedback when needed.
Group meeting were only needed to discuss refactors. 

\subsection{Michele Ceccacci}
\begin{itemize}
	\item TemperatureTest
	\item AirqualityStateTest
	\item AbstractTemperatureChangerTest
	\item AirConditioningTest
	\item  HeatingTest
	\item LoggerImplTest
\end{itemize}

\subsection{Michele Ceccacci}
\begin{itemize}
	\item \textbf{Optional}s were used when the value could either be present or not
	\item \textbf{Streams} were used to access and modify data, especially data that used optional types
	\item \textbf{Records} to make data immutability more explicit, and to avoid reimplementing constructors/HashCode methods
	\item \textbf{Lambda} functions and functional interfaces were used to make code more readable and often complemented streams 
	\item \textbf{JavaFX} was used to develop view Components
	\item \textbf{Generics} were used to reduce code duplication, especially in the view
\end{itemize}

\chapter{Final comments}

\section{Self evaluation and final comments}

\subsection{Michele Ceccacci}
This project definitely improved my teamworking and software architecture skills. 
This was my first time participating in a greenfield project this big, and my first time 
taking architectural decisions that would carry over the whole software's lifecycle. 
In my previous work experience and open source contriubtions, i was more focused on  adding new features 
to an existing project or fixing tickets, rather than actual softare architecture. 
I was familiar proficient at git, but i still made some occasional mistakes.
I think that working in a team without a more senior figure acting as the  lead definitely 
made me more  self reliant, and allowed me to dig deeper into problems.

\appendix
\chapter{Guida utente}

Capitolo in cui si spiega come utilizzare il software. Nel caso in cui il suo uso sia del tutto
banale, tale capitolo può essere omesso.
%
A tal riguardo, si fa presente agli studenti che i docenti non hanno mai utilizzato il software
prima, per cui aspetti che sembrano del tutto banali a chi ha sviluppato l'applicazione possono non
esserlo per chi la usa per la prima volta.
%
Se, ad esempio, per cominciare una partita con un videogioco è necessario premere la barra
spaziatrice, o il tasto ``P'', è necessario che gli studenti lo segnalino.

\subsection*{Elementi positivi}

\begin{itemize}
 \item Si istruisce in modo semplice l'utente sull'uso dell'applicazione, eventualmente facendo uso di schermate e descrizioni.
\end{itemize}

\subsection*{Elementi negativi}
\begin{itemize}
 \item Si descrivono in modo eccessivamente minuzioso tutte le caratteristiche, anche minori, del software in oggetto.
 \item Manca una descrizione che consenta ad un utente qualunque di utilizzare almeno le funzionalità primarie dell'applicativo.
\end{itemize}

\chapter{Esercitazioni di laboratorio}

In questo capitolo ciascuno studente elenca gli esercizi di laboratorio che ha svolto
(se ne ha svolti),
elencando i permalink dei post sul forum dove è avvenuta la consegna.
%
Questa sezione potrebbe essere processata da strumenti automatici,
per cui link a oggetti diversi dal permalink della consegna,
errori nell'email o nel nome del laboratorio possono portare ad ignorare alcune consegne,
si raccomanda la massima precisione.

\section*{Esempio}

\subsection{paolino.paperino@studio.unibo.it}

\begin{itemize}
 \item Laboratorio 04: \url{https://virtuale.unibo.it/mod/forum/discuss.php?d=12345#p123456}
 \item Laboratorio 06: \url{https://virtuale.unibo.it/mod/forum/discuss.php?d=22222#p222222}
 \item Laboratorio 09: \url{https://virtuale.unibo.it/mod/forum/discuss.php?d=99999#p999999}
\end{itemize}

\subsection{paperon.depaperoni@studio.unibo.it}

\begin{itemize}
 \item Laboratorio 04: \url{https://virtuale.unibo.it/mod/forum/discuss.php?d=12345#p123456}
 \item Laboratorio 05: \url{https://virtuale.unibo.it/mod/forum/discuss.php?d=22222#p222222}
 \item Laboratorio 06: \url{https://virtuale.unibo.it/mod/forum/discuss.php?d=99999#p999999}
 \item Laboratorio 07: \url{https://virtuale.unibo.it/mod/forum/discuss.php?d=22222#p222222}
 \item Laboratorio 08: \url{https://virtuale.unibo.it/mod/forum/discuss.php?d=99999#p999999}
 \item Laboratorio 09: \url{https://virtuale.unibo.it/mod/forum/discuss.php?d=22222#p222222}
 \item Laboratorio 10: \url{https://virtuale.unibo.it/mod/forum/discuss.php?d=99999#p999999}
 \item Laboratorio 11: \url{https://virtuale.unibo.it/mod/forum/discuss.php?d=22222#p222222}
\end{itemize}


\bibliographystyle{alpha}
\bibliography{13-template}

\end{document}
